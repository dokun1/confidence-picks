# Backend Development Guidelines

## 🧪 Testing Requirements

**CRITICAL**: All changes to the backend MUST include corresponding test updates to ensure functionality remains intact.

### When making changes, you MUST:

1. **Update existing tests** if you modify functionality
2. **Add new tests** if you create new features
3. **Run tests locally** before submitting changes
4. **Ensure all tests pass** in CI/CD pipeline

### Test Structure

- **Database Tests** (`tests/db-init.test.js`): Test schema, tables, constraints, indexes
- **Server Tests** (`tests/server.test.js`): Test server startup and graceful shutdown
- **API Tests** (`tests/routes.test.js`): Test all endpoints, authentication, error handling

### Running Tests Locally

```bash
# Start test database
npm run test:setup

# Initialize test database
npm run db:init

# Run specific test suites
npm run test:db      # Database tests
npm run test:server  # Server tests
npm run test:routes  # API routes tests

# Run all tests
npm test

# Clean up
npm run test:teardown
```

### Test Environment

- Uses isolated PostgreSQL database via Docker
- Environment variables from `.env.test`
- Separate from development/production databases
- Automatic cleanup after tests

### Adding New Tests

When adding new features:

1. **Database changes**: Update `db-init.test.js` to verify new tables/columns/constraints
2. **New API endpoints**: Add tests to `routes.test.js` with success/error cases
3. **Authentication changes**: Update auth-related tests
4. **Model changes**: Test CRUD operations and business logic

### Test Guidelines

- **Isolation**: Each test should be independent
- **Cleanup**: Always clean up test data
- **Coverage**: Test both success and error scenarios
- **Descriptive**: Use clear test names and error messages
- **Performance**: Keep tests fast and focused

## 🚨 Pull Request Requirements

- ✅ All tests must pass
- ✅ New features must have corresponding tests
- ✅ Test coverage must not decrease
- ✅ Tests must run successfully in CI/CD

## 🛠️ Development Workflow

1. Make your changes
2. Update/add tests
3. Run tests locally: `npm test`
4. Ensure all tests pass
5. Commit and push
6. Verify CI/CD tests pass

**Remember**: Code without tests is considered incomplete. Always maintain test coverage to ensure reliability and prevent regressions.
